<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioC Asia 2021 RCy3 を用いた Cytoscape automation ワークショップ • cyautoworkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BioC Asia 2021 RCy3 を用いた Cytoscape automation ワークショップ">
<meta property="og:description" content="cyautoworkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cyautoworkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cyautoworkshop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cyautoworkshop_ja.html">BioC Asia 2021 RCy3 を用いた Cytoscape automation ワークショップ</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kozo2/cyautoworkshop">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cyautoworkshop_ja_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BioC Asia 2021 RCy3 を用いた Cytoscape automation ワークショップ</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kozo2/cyautoworkshop/blob/master/vignettes/cyautoworkshop_ja.Rmd"><code>vignettes/cyautoworkshop_ja.Rmd</code></a></small>
      <div class="hidden name"><code>cyautoworkshop_ja.Rmd</code></div>

    </div>

    
    
<div id="ワークショップ前の手順" class="section level1">
<h1 class="hasAnchor">
<a href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97%E5%89%8D%E3%81%AE%E6%89%8B%E9%A0%86" class="anchor"></a>ワークショップ前の手順</h1>
<p><em>ワークショップの前に</em> 次の手順を実行してください。</p>
<div id="ステップ-1-デスクトップ環境に最新のcytoscape-3-9-0-をインストールします" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%82%B9%E3%83%86%E3%83%83%E3%83%97-1-%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E7%92%B0%E5%A2%83%E3%81%AB%E6%9C%80%E6%96%B0%E3%81%AEcytoscape-3-9-0-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%BE%E3%81%99" class="anchor"></a>ステップ 1: デスクトップ環境に最新のCytoscape (3.9.0) をインストールします</h2>
<ul>
<li>
<a href="https://cytoscape.org/download.html">ここから Cytoscape のインストーラをダウンロード</a>。</li>
<li>Javaが無ければ合わせてインストールしてくれます。</li>
<li>スタートメニューまたはデスクトップショートカットからCytoscape3.9.0を起動します</li>
</ul>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139441980-5d73579f-39dd-45da-916b-759eff99474d.png" alt=""><p class="caption">image</p>
</div>
<ul>
<li>上の画像のようなメッセージが表示されますので、OKボタンを押してCytoscapeを再起動してください。</li>
<li>Cytoscape は立ち上げっぱなしにしておいてください。</li>
</ul>
</div>
<div id="ステップ-2-docker-環境の立ち上げと-google-chrome-を用いたその環境へのアクセス" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%82%B9%E3%83%86%E3%83%83%E3%83%97-2-docker-%E7%92%B0%E5%A2%83%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E3%81%A8-google-chrome-%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E3%81%9D%E3%81%AE%E7%92%B0%E5%A2%83%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9" class="anchor"></a>ステップ 2: Docker 環境の立ち上げと Google Chrome を用いたその環境へのアクセス</h2>
<ul>
<li>
<code>docker run -d -p 8888:8888 kozo2/cyautoworkshop</code> をあなたのPCで実行します。</li>
<li>Google Chrome で <code>http://localhost:8888</code> を開きます。Safariでは動作しません。Firefoxは動作するかもしれませんが確認していません。</li>
</ul>
</div>
</div>
<div id="ワークショップ-入門編" class="section level1">
<h1 class="hasAnchor">
<a href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97-%E5%85%A5%E9%96%80%E7%B7%A8" class="anchor"></a>ワークショップ (入門編)</h1>
<div id="自己紹介" class="section level2">
<h2 class="hasAnchor">
<a href="#%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B" class="anchor"></a>自己紹介</h2>
<p>西田 孝三</p>
<ul>
<li>Bioconductor Community Advisory Board (CAB) のメンバー</li>
<li>RCy3 を用いた Bioconductor package (transomics2cytoscape) の作者</li>
<li>Cytoscape のコミュニティへの貢献 (Google Summer of Code, Google Season of Docs)</li>
<li>KEGGscape Cytoscape App の KEGGscape の作者</li>
</ul>
</div>
<div id="cytoscape-とは何ですか" class="section level2">
<h2 class="hasAnchor">
<a href="#cytoscape-%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%A7%E3%81%99%E3%81%8B" class="anchor"></a>Cytoscape とは何ですか?</h2>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139426468-915e9a76-7e4e-4a37-aee9-3d0e344f551e.png" alt=""><p class="caption">image</p>
</div>
<ul>
<li>オープンソースの、クロスプラットフォームの、JavaデスクトップGUIアプリ。</li>
<li>ネットワーク可視化のためのもの。</li>
</ul>
<div id="コアコンセプト" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%82%B3%E3%82%A2%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88" class="anchor"></a>コアコンセプト</h3>
<p><strong>ネットワークとテーブル</strong>: ネットワークのノードとエッジはアノテーションのテーブルを持っています。</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139427094-bfd9a839-dabf-468d-8f28-6458443c8e61.png" alt=""><p class="caption">image</p>
</div>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139427149-4f0fe568-3851-4de6-834e-2e809e85f1be.png" alt=""><p class="caption">image</p>
</div>
<p>色、形、サイズ、他何らか、といった「見栄え」をアノテーションの値によってスタイリングします。</p>
</div>
</div>
<div id="なぜ自動化する必要があるんですか" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%81%AA%E3%81%9C%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8B%E3%82%93%E3%81%A7%E3%81%99%E3%81%8B" class="anchor"></a>なぜ自動化する必要があるんですか?</h2>
<p>GUIを直接使用できるのに、なぜCytoscapeを自動化するのですか？</p>
<ul>
<li>ループなど、複数回実行したいことのために</li>
<li>将来繰り返したいこと(再現)のために</li>
<li>同僚と共有したり公開したりしたいもののために</li>
<li>RやPythonなどですでに取り組んでいるものを活かすために</li>
</ul>
<p>端的には「再現性」「データ共有」「RかPythonの資源活用」のため。</p>
</div>
<div id="cytoscape-gui操作はどのように自動化を実現しているのですか" class="section level2">
<h2 class="hasAnchor">
<a href="#cytoscape-gui%E6%93%8D%E4%BD%9C%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E8%87%AA%E5%8B%95%E5%8C%96%E3%82%92%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8B" class="anchor"></a>Cytoscape GUI操作はどのように自動化を実現しているのですか?</h2>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139397677-80076550-e458-4bd4-9ab5-ba48ef6843b9.png" alt=""><p class="caption">image</p>
</div>
<ul>
<li><p>REST APIでそれを可能にしています。ほとんどすべてのGUI 操作がREST APIで行えるようになっています。</p></li>
<li><p>昨今のCytoscapeはデスクトップアプリケーションであるだけでなく、RESTサーバーでもあります。</p></li>
<li>
<p>以下のコマンドで、Cytoscapeがサーバーとして機能しているかどうかを確認できます。</p>
<pre><code>curl localhost:1234</code></pre>
</li>
<li><p>RCy3 または py4cytoscape といったパッケージはそのREST APIのラッパーです。</p></li>
<li><p>py4cytoscape は RCy3 の Pythonクローンです。最近できました。py4cytoscape は RCy3 と同じ関数仕様を持っているため、片方使えると両方使えるようになったのと同じです。</p></li>
<li><p>バイオインフォマティクスにはテーブル操作が不可欠であるため、RやPythonでCytoscapeを操作できると便利です。dplyrやpandasがあるからです。そういったテーブル操作をCytoscapeのGUIで行うのは面倒です。</p></li>
</ul>
<p><a href="https://dx.doi.org/10.12688%2Ff1000research.6767.1">CyREST: Turbocharging Cytoscape Access for External Tools via a RESTful API. F1000Research 2015.</a></p>
<p><a href="https://doi.org/10.1186/s13059-019-1758-4">Cytoscape Automation: empowering workflow-based network analysis. Genome Biology 2019.</a></p>
</div>
<div id="rcy3を用いた自動化" class="section level2">
<h2 class="hasAnchor">
<a href="#rcy3%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E8%87%AA%E5%8B%95%E5%8C%96" class="anchor"></a>RCy3を用いた自動化</h2>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139400142-8a2a764b-dbbe-4e47-9d3c-d4cc07602468.png" alt=""><p class="caption">image</p>
</div>
<p><a href="https://f1000research.com/articles/8-1774">RCy3: Network biology using Cytoscape from within R. F1000Research 2019.</a></p>
</div>
<div id="rcy3を使用してrのデータをcytoscapeネットワークに変換する" class="section level2">
<h2 class="hasAnchor">
<a href="#rcy3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6r%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92cytoscape%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B" class="anchor"></a>RCy3を使用してRのデータをCytoscapeネットワークに変換する</h2>
<p>ネットワークは、生物学的データを表すための便利な方法を提供してくれます。 しかし、データをRからCytoscapeにシームレスに変換するにはどうすればよいでしょうか?</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139404069-536a67a2-e8fe-4072-bc42-74bfb060f924.png" alt=""><p class="caption">image</p>
</div>
<p>ここからいよいよハンズオンです。細かいことはおいておいてとにかくRとCytoscapeを接続しましょう。</p>
<p>以下のコードを実行する前に、ローカルのCytoscapeが完全に起動しきっていることを確認してください。 Cytoscapeが起動し、RESTサーバーが完全に起動するまでには少し時間がかかります。 (大体10秒くらい待ちます。)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cytoscape/RCy3">RCy3</a></span><span class="op">)</span>
<span class="va">browserClientJs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getBrowserClientJs.html">getBrowserClientJs</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">IRdisplay</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IRdisplay/man/display-textual.html">display_javascript</a></span><span class="op">(</span><span class="va">browserClientJs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/cytoscapePing.html">cytoscapePing</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="なぜ-jupyter-が-cytoscape-の-rest-サービスと通信できたのですか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%AA%E3%81%9C-jupyter-%E3%81%8C-cytoscape-%E3%81%AE-rest-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A8%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8B" class="anchor"></a>なぜ Jupyter が Cytoscape の REST サービスと通信できたのですか？</h3>
<p>下記で何が起こったのかについての詳細な説明が必要ですね。</p>
<pre><code>browserClientJs &lt;- getBrowserClientJs()
IRdisplay::display_javascript(browserClientJs)</code></pre>
<p>上記のコードでは、<strong>Jupyter Bridge</strong> と呼ばれるテクノロジーを使用しました。 Jupyter Bridgeは、リモートの REST クライアントからの HTTP リクエストをローカルリクエストのように見せかける JavaScript 実装です。</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139530994-8afd99b2-1175-46b3-9ad7-166d8ba78f2a.png" alt=""><p class="caption">image</p>
</div>
<p>デスクトップ環境内のCytoscapeにリモート環境からアクセスするのは難しいため、Jupyter Bridgeを使用します。</p>
<p>そしてこのワークショップが他のワークショップと違って <a href="http://app.orchestra.cancerdatasci.org/">Orchestra</a> で動かなかったのは この Jupyter Bridge のせいでもあります。</p>
<p>そのため私はローカルの Docker 環境内の Jupyter で Jupyter Bridge を使いました。 ローカルでなくても Orchestra でないリモートサーバーで私の Docker イメージを使うなら問題無く動作します。</p>
</div>
<div id="で-なぜ-jupyter-bridge-を使うのですか-ややこしくないですか-ノートブックを使わなければよいのではないですか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%A7-%E3%81%AA%E3%81%9C-jupyter-bridge-%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8B-%E3%82%84%E3%82%84%E3%81%93%E3%81%97%E3%81%8F%E3%81%AA%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B-%E3%83%8E%E3%83%BC%E3%83%88%E3%83%96%E3%83%83%E3%82%AF%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B" class="anchor"></a>(で) なぜ Jupyter Bridge を使うのですか? ややこしくないですか? ノートブックを使わなければよいのではないですか?</h3>
<ul>
<li>ユーザーは依存関係や環境について心配する必要が無いからです。</li>
<li>ノートブックベースのワークフローとデータセットを簡単に共有できるからです。</li>
<li>ワークフローはクラウドに常駐し、クラウドリソースにアクセスし、それでもCytoscape機能を使用できるところがよいのです。</li>
</ul>
</div>
<div id="rデータをcytoscapeネットワークに変換する方法に戻りましょう" class="section level3">
<h3 class="hasAnchor">
<a href="#r%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92cytoscape%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%81%AB%E6%88%BB%E3%82%8A%E3%81%BE%E3%81%97%E3%82%87%E3%81%86" class="anchor"></a>RデータをCytoscapeネットワークに変換する方法に戻りましょう…</h3>
<p>いくつかの基本的なRオブジェクトからCytoscapeネットワークを作成します</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"node 0"</span>,<span class="st">"node 1"</span>,<span class="st">"node 2"</span>,<span class="st">"node 3"</span><span class="op">)</span>,
    group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span><span class="op">)</span>, <span class="co"># categorical strings</span>
    score<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>, <span class="co"># integers</span>
    stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nodes</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>source<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"node 0"</span>,<span class="st">"node 0"</span>,<span class="st">"node 0"</span>,<span class="st">"node 2"</span><span class="op">)</span>,
    target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"node 1"</span>,<span class="st">"node 2"</span>,<span class="st">"node 3"</span>,<span class="st">"node 3"</span><span class="op">)</span>,
    interaction<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inhibits"</span>,<span class="st">"interacts"</span>,<span class="st">"activates"</span>,<span class="st">"interacts"</span><span class="op">)</span>,  <span class="co"># optional</span>
    weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.1</span>,<span class="fl">3.0</span>,<span class="fl">5.2</span>,<span class="fl">9.9</span><span class="op">)</span>, <span class="co"># numeric</span>
    stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edges</span></code></pre></div>
<div id="ネットワークの作成に使用されるデータフレーム" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0" class="anchor"></a>ネットワークの作成に使用されるデータフレーム</h4>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139534280-0c569dfd-d66d-4054-9b58-becce79225bc.png" alt=""><p class="caption">image</p>
</div>
</div>
<div id="さあrcy3からネットワークを作りましょう" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%81%95%E3%81%82rcy3%E3%81%8B%E3%82%89%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E4%BD%9C%E3%82%8A%E3%81%BE%E3%81%97%E3%82%87%E3%81%86" class="anchor"></a>さあ、RCy3からネットワークを作りましょう</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/createNetworkFromDataFrames.html">createNetworkFromDataFrames</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, title<span class="op">=</span><span class="st">"my first network"</span>, collection<span class="op">=</span><span class="st">"DataFrame Example"</span><span class="op">)</span></code></pre></div>
</div>
<div id="ネットワークの画像をエクスポートしましょう" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86" class="anchor"></a>ネットワークの画像をエクスポートしましょう</h4>
<p>大部分の人の目的はCytoscapeの画を論文のFigureに使うことでしょう。 ですので画像を取得する方法が知りたいでしょう。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/exportImage.html">exportImage</a></span><span class="op">(</span><span class="st">"my_first_network"</span>, type <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></code></pre></div>
<p>入門編のシンプルなネットワーク</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139537190-1f79f871-5dbd-4779-9a4f-7c67f263101b.png" alt=""><p class="caption">image</p>
</div>
</div>
</div>
</div>
</div>
<div id="ワークショップ-実践編" class="section level1">
<h1 class="hasAnchor">
<a href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97-%E5%AE%9F%E8%B7%B5%E7%B7%A8" class="anchor"></a>ワークショップ (実践編)</h1>
<div id="ユースケースの例" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE%E4%BE%8B" class="anchor"></a>ユースケースの例</h2>
<p><strong>オミックスデータ</strong> - 私は ほげほげ (microarray, RNASeq, Metabolomics, Proteomics, ATACseq, MicroRNA, GWAS …) データを持っています。 データをそれを何らかの解析をしてスコアリングしました。 データを既存のインタラクションデータ(PPI, パスウェイ, その他何か)にオーバーレイするにはどうすればよいですか?</p>
</div>
<div id="サンプルデータセット" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88" class="anchor"></a>サンプルデータセット</h2>
<p>We downloaded gene expression data from the Ovarian Serous Cystadenocarcinoma project of The Cancer Genome Atlas (TCGA)(International Genome et al.), <a href="http://cancergenome.nih.gov" class="uri">http://cancergenome.nih.gov</a> via the Genomic Data Commons (GDC) portal(Grossman et al.) on 2017-06-14 using <a href="http://bioconductor.org/packages/release/bioc/html/TCGAbiolinks.html">TCGABiolinks Bioconductor package(Colaprico et al.)</a>.</p>
<p>The Cancer Genome Atlas (TCGA)(International Genome et al.) の the Ovarian Serous Cystadenocarcinoma プロジェクトから遺伝子発現データをダウンロードしました。 <a href="http://cancergenome.nih.gov" class="uri">http://cancergenome.nih.gov</a> それには2017年6月14日に <a href="http://bioconductor.org/packages/release/bioc/html/TCGAbiolinks.html">TCGABiolinks Bioconductor package(Colaprico et al.)</a>. を用いて the Genomic Data Commons (GDC) portal(Grossman et al.) 由来でデータを取得しました。</p>
<ul>
<li>RNA-seq データとして利用可能な300サンプル</li>
<li>79サンプルは Immunoreactive として, 72サンプルは Mesenchymal として, 69サンプルは Differentiated として, そして80サンプルは Proliferative サンプルとして分類されています。</li>
<li>データは正規化され、残りのサンプルと比較して各癌クラスのdifferential expressionが計算されています。</li>
</ul>
<p>分析の結果として次の表を使用して、相互作用ネットワークに統合します:</p>
<ul>
<li>
<a href="https://cytoscape.org/cytoscape-tutorials/presentations/modules/RCy3_ExampleData/data/TCGA_OV_RNAseq_All_edgeR_scores.txt">Gene ranks</a> - 4種の比較(mesenchymal vs rest, differential vs rest, proliferative vs rest and immunoreactive vs rest)に対する p-value, FDR そして foldchange の値を含んだ解析結果の行列です。</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RCurl</span><span class="op">)</span>
<span class="va">matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCurl/man/getURL.html">getURL</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/cytoscape/cytoscape-tutorials/gh-pages/presentations/modules/RCy3_ExampleData/data/TCGA_OV_RNAseq_All_edgeR_scores.txt"</span><span class="op">)</span>
<span class="va">RNASeq_gene_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">matrix</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, quote<span class="op">=</span><span class="st">"\""</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RNASeq_gene_scores</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_mesenchymal_genes</span> <span class="op">&lt;-</span> <span class="va">RNASeq_gene_scores</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">FDR.mesen</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">logFC.mesen</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">top_mesenchymal_genes</span><span class="op">)</span></code></pre></div>
</div>
<div id="ユースケース-私の上位の遺伝子はどのように関連していますか" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9-%E7%A7%81%E3%81%AE%E4%B8%8A%E4%BD%8D%E3%81%AE%E9%81%BA%E4%BC%9D%E5%AD%90%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B" class="anchor"></a>ユースケース-私の上位の遺伝子はどのように関連していますか？</h2>
<p>相互作用データを格納しているデータベースは無限にあります。</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139541346-9e223e88-e6df-4e4d-b7f2-a5836f6e97eb.png" alt=""><p class="caption">image</p>
</div>
<p>STRINGデータベースにクエリを実行して、トップのMesenchymalの遺伝子のセットに対して見つかったすべての相互作用を取得します。</p>
<div id="ネットワークデータを使用した-cytoscape-apps" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F-cytoscape-apps" class="anchor"></a>ネットワークデータを使用した Cytoscape Apps</h3>
<p>ありがたいことに、遺伝子それぞれを個別にクエリする必要はありません。</p>
<p>多くの特殊な（たとえば、特定の分子、相互作用の種類、または種の）相互作用データベースに加えて、これらのデータベースを照合して、より使いやすい幅広いリソースを作成するデータベースもあります。例えば：</p>
<ul>
<li>
<a href="https://apps.cytoscape.org/apps/stringapp">stringApp</a> - は <a href="https://doi.org/10.1093/nar/gkaa1074">STRING(Szklarczyk et al.)</a> から protein-protein そして protein-chemical にクエリをかけてそれをネットワークとしてCytoscapeにインポートしてくれます。</li>
</ul>
<p>この “App” のインストールもRで自動的に行えます。</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/installApp.html">installApp</a></span><span class="op">(</span><span class="st">"stringApp"</span><span class="op">)</span></code></pre></div>
<p>次の方法で正常にインストールされたことを確認できます:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getAppStatus.html">getAppStatus</a></span><span class="op">(</span><span class="st">"stringApp"</span><span class="op">)</span></code></pre></div>
</div>
<div id="特定のcytoscapeコマンドのヘルプ" class="section level3">
<h3 class="hasAnchor">
<a href="#%E7%89%B9%E5%AE%9A%E3%81%AEcytoscape%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E3%83%98%E3%83%AB%E3%83%97" class="anchor"></a>特定のCytoscapeコマンドのヘルプ</h3>
<p>Rの環境から個々のコマンドに関する情報を取得するには、commandsHelp関数を使用することでできます。 コマンドに名前を追加して、情報を取得するコマンドを指定するだけです。 たとえば “commandsHelp(”help string”)“ といったふうにです。</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/commandsHelp.html">commandsHelp</a></span><span class="op">(</span><span class="st">"help"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/commandsHelp.html">commandsHelp</a></span><span class="op">(</span><span class="st">"help string"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/commandsHelp.html">commandsHelp</a></span><span class="op">(</span><span class="st">"help string protein query"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mesen_string_interaction_cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'string protein query taxonID=9606 limit=150 cutoff=0.9 query="'</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">top_mesenchymal_genes</span><span class="op">$</span><span class="va">Name</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,<span class="st">'"'</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/commandsGET.html">commandsGET</a></span><span class="op">(</span><span class="va">mesen_string_interaction_cmd</span><span class="op">)</span></code></pre></div>
<ul>
<li>cutoff: 信頼スコアは、この相互作用が存在するという累積された証拠を反映しています。このカットオフよりも大きいスコアのインタラクションのみが返されます。</li>
<li>limit: クエリセットに加えて返されるタンパク質の最大数。</li>
<li>query: タンパク質名または識別子のコンマ区切りリスト。</li>
<li>taxonID: 種の分類ID。 IDについては、NCBI分類のホームページを参照してください。種とtaxonIDの両方が異なる種に設定されている場合、taxonIDが優先されます。</li>
</ul>
<p>詳細については、Cytoscapeメニューバーの “Help -&gt; Automation -&gt; CyREST Commands API” を参照してください。</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/exportImage.html">exportImage</a></span><span class="op">(</span><span class="st">"initial_string_network"</span>, type <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139543384-b19ac0f3-1dc9-4e6d-a212-af4f19ab6529.png" alt=""><p class="caption">initial_string_network</p>
</div>
</div>
<div id="レイアウト" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88" class="anchor"></a>レイアウト</h3>
<p>ネットワークをレイアウトするのも自動的に行えます。</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/layoutNetwork.html">layoutNetwork</a></span><span class="op">(</span><span class="st">'force-directed'</span><span class="op">)</span></code></pre></div>
<p>試してみることができる他のレイアウトアルゴリズムを確認してください。</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getLayoutNames.html">getLayoutNames</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="レイアウト-続き" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88-%E7%B6%9A%E3%81%8D" class="anchor"></a>レイアウト-続き</h3>
<p>特定のレイアウトのパラメーターを取得する。</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getLayoutPropertyNames.html">getLayoutPropertyNames</a></span><span class="op">(</span>layout.name<span class="op">=</span><span class="st">'force-directed'</span><span class="op">)</span></code></pre></div>
<p>force directed レイアウトを使用してネットワークを再レイアウトしますが、今度はいくつかのパラメーターを指定してみましょう。 このような「パラメーターを変えてまた試す」といった際に「自動化」は大いに役立つことがお分かりになるでしょう。</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/layoutNetwork.html">layoutNetwork</a></span><span class="op">(</span><span class="st">'force-directed defaultSpringCoefficient=0.0000008 defaultSpringLength=70'</span><span class="op">)</span></code></pre></div>
<p>再レイアウトされたネットワークのスクリーンショットを取得する。</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/exportImage.html">exportImage</a></span><span class="op">(</span><span class="st">"relayout_string_network"</span>, type <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">response</span></code></pre></div>
<p>新しいレイアウトのSTRINGのネットワーク</p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139554068-55353d6a-62e2-4956-b2c6-cda4cc5a28d8.png" alt=""><p class="caption">relayout_string_network</p>
</div>
</div>
</div>
<div id="stringネットワークに発現解析データをオーバーレイします" class="section level2">
<h2 class="hasAnchor">
<a href="#string%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E7%99%BA%E7%8F%BE%E8%A7%A3%E6%9E%90%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AC%E3%82%A4%E3%81%97%E3%81%BE%E3%81%99" class="anchor"></a>STRINGネットワークに発現解析データをオーバーレイします</h2>
<p>これを行うには、RCy3のloadTableData関数を使用します。 IDの種類が一致していることを確認することが重要です。 ノード属性テーブルの列名を取得することで、STRINGが何を使用しているかを確認できます。</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getTableColumnNames.html">getTableColumnNames</a></span><span class="op">(</span><span class="st">'node'</span><span class="op">)</span></code></pre></div>
</div>
<div id="stringネットワークに発現解析データをオーバーレイします-続き" class="section level2">
<h2 class="hasAnchor">
<a href="#string%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E7%99%BA%E7%8F%BE%E8%A7%A3%E6%9E%90%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AC%E3%82%A4%E3%81%97%E3%81%BE%E3%81%99-%E7%B6%9A%E3%81%8D" class="anchor"></a>STRINGネットワークに発現解析データをオーバーレイします-続き</h2>
<p>各列が何であるかわからず、使用する列をさらに確認したい場合は、ノード属性テーブル全体をプルすることもできます。</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node_attribute_table_topmesen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getTableColumns.html">getTableColumns</a></span><span class="op">(</span>table<span class="op">=</span><span class="st">"node"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">node_attribute_table_topmesen</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139554236-dc19aaf7-8186-40f0-9ed3-d50a46c64d27.png" alt=""><p class="caption">image</p>
</div>
<p>“display name” の列には、Ovarian Cancerデータセットにも含まれている HGNC 遺伝子名が含まれています。</p>
<p>発現データをインポートするには、そのデータセットを “display name” ノード属性に一致させます。</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/loadTableData.html">loadTableData</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span>, table.key.column <span class="op">=</span> <span class="st">"display name"</span>, data.key.column <span class="op">=</span> <span class="st">"Name"</span><span class="op">)</span>  <span class="co">#default data.frame key is row.names</span></code></pre></div>
</div>
<div id="ビジュアルスタイル" class="section level2">
<h2 class="hasAnchor">
<a href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB" class="anchor"></a>ビジュアルスタイル</h2>
<p>ビジュアルスタイルを変更する独自の視覚スタイルを作成して、STRINGネットワーク上の発現データを可視化してみましょう。 まずはデフォルトのスタイルから始めます。</p>
<p><strong>フォーマットされたSTRINGネットワーク</strong></p>
<div class="figure">
<img src="https://user-images.githubusercontent.com/12192/139555494-3d46d339-153d-4c93-bf06-c393375ba2be.png" alt=""><p class="caption">mesen_string_network</p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">style.name</span> <span class="op">=</span> <span class="st">"MesenchymalStyle"</span>
<span class="va">defaults.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>NODE_SHAPE<span class="op">=</span><span class="st">"ellipse"</span>,
                 NODE_SIZE<span class="op">=</span><span class="fl">60</span>,
                 NODE_FILL_COLOR<span class="op">=</span><span class="st">"#AAAAAA"</span>,
                 EDGE_TRANSPARENCY<span class="op">=</span><span class="fl">120</span><span class="op">)</span>
<span class="co"># p for passthrough; nothing else needed</span>
<span class="va">node.label.map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/mapVisualProperty.html">mapVisualProperty</a></span><span class="op">(</span><span class="st">'node label'</span>,<span class="st">'display name'</span>,<span class="st">'p'</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/createVisualStyle.html">createVisualStyle</a></span><span class="op">(</span><span class="va">style.name</span>, <span class="va">defaults.list</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">node.label.map</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/setVisualStyle.html">setVisualStyle</a></span><span class="op">(</span>style.name<span class="op">=</span><span class="va">style.name</span><span class="op">)</span></code></pre></div>
<div id="ビジュアルスタイル-続き" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB-%E7%B6%9A%E3%81%8D" class="anchor"></a>ビジュアルスタイル-続き</h3>
<p>MesenchymalのlogFCの発現に対するマッピングを使用して、作成したスタイルを更新します。 最初のステップは、Cytoscapeから列データを取得し（上記のnode_attributeテーブルの概念を再利用できますが、式データを追加したので、関数を再度呼び出す必要があります）、最小値と最大値を引き出して値の範囲に対するデータマッピングを定義します。</p>
<p>注：データセット全体、または現在Cytoscapeで表されているサブセットのみに基づいて最小値と最大値を定義できます。2つの方法では、異なる結果が得られます。 同じデータセットで作成された異なるネットワークを比較する場合は、サブセットではなく、データセット全体から最小値と最大値を計算するのが最善です。</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">min.mesen.logfc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">logFC.mesen</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">max.mesen.logfc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">logFC.mesen</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">data.values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min.mesen.logfc</span>,<span class="fl">0</span>,<span class="va">max.mesen.logfc</span><span class="op">)</span></code></pre></div>
</div>
<div id="ビジュアルスタイル-続き-1" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB-%E7%B6%9A%E3%81%8D-1" class="anchor"></a>ビジュアルスタイル-続き</h3>
<p>次に、RColorBrewer パッケージを使用して、データ値と組み合わせるのに適した色を選択します。</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">data.values</span><span class="op">)</span>, colorblindFriendly<span class="op">=</span><span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"div"</span><span class="op">)</span></code></pre></div>
</div>
<div id="ノードの色を-logfc-に" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E8%89%B2%E3%82%92-logfc-%E3%81%AB" class="anchor"></a>ノードの色を logFC に。</h3>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node.colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">data.values</span><span class="op">)</span>, <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>色をデータ値にマッピングし、ビジュアルスタイルを更新します。</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/setNodeColorMapping.html">setNodeColorMapping</a></span><span class="op">(</span><span class="st">"logFC.mesen"</span>, <span class="va">data.values</span>, <span class="va">node.colors</span>, style.name<span class="op">=</span><span class="va">style.name</span><span class="op">)</span></code></pre></div>
</div>
<div id="ビジュアルスタイル-続き-2" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB-%E7%B6%9A%E3%81%8D-2" class="anchor"></a>ビジュアルスタイル-続き</h3>
<p>STRINGには、クエリタンパク質と、クエリタンパク質に関連する他のタンパク質（最初に最も強い接続を含む）が含まれることを忘れないでください。 このネットワークのすべてのタンパク質があなたのトップヒットであるわけではありません。どのタンパク質がトップMesenchymalヒットであるかをどのように可視化できますか？</p>
<p>別の(境界線の)色を追加するか、トップヒットのノードの形状を変更してみましょう。</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/getNodeShapes.html">getNodeShapes</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">#select the Nodes of interest</span>
<span class="co">#selectNode(nodes = top_mesenchymal_genes$Name, by.col="display name")</span>
<span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/setNodeShapeBypass.html">setNodeShapeBypass</a></span><span class="op">(</span>node.names <span class="op">=</span> <span class="va">top_mesenchymal_genes</span><span class="op">$</span><span class="va">Name</span>, new.shapes <span class="op">=</span> <span class="st">"TRIANGLE"</span><span class="op">)</span></code></pre></div>
</div>
<div id="ビジュアルスタイル-続き-3" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB-%E7%B6%9A%E3%81%8D-3" class="anchor"></a>ビジュアルスタイル-続き</h3>
<p>最後に Mesenchymal の p-value と相関するノードのサイズを変更しましょう。</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RCy3/man/setNodeSizeMapping.html">setNodeSizeMapping</a></span><span class="op">(</span>table.column <span class="op">=</span> <span class="st">'LR.mesen'</span>, 
                   table.column.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">LR.mesen</span><span class="op">)</span>, 
                                           <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">LR.mesen</span><span class="op">)</span>, 
                                           <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">RNASeq_gene_scores</span><span class="op">$</span><span class="va">LR.mesen</span><span class="op">)</span><span class="op">)</span>, 
                   sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">150</span><span class="op">)</span>, mapping.type <span class="op">=</span> <span class="st">"c"</span>, style.name <span class="op">=</span> <span class="va">style.name</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="ありがとうございました" class="section level1">
<h1 class="hasAnchor">
<a href="#%E3%81%82%E3%82%8A%E3%81%8C%E3%81%A8%E3%81%86%E3%81%94%E3%81%96%E3%81%84%E3%81%BE%E3%81%97%E3%81%9F" class="anchor"></a>ありがとうございました!</h1>
<p>これで基本的なしくみだけでなく論文のような図を作る実践的な方法も学習できましたね。</p>
<p>役立つと思われる追加のリソースは次のとおりです:</p>
<ul>
<li>manual.cytoscape.org</li>
<li>tutorials.cytoscape.org</li>
<li>automation.cytoscape.org</li>
<li>apps.cytoscape.org</li>
<li>cytoscape-publications.tumblr.com</li>
<li><a href="https://cytoscape.org/documentation_users.html">cytoscape help page</a></li>
<li><a href="https://cytoscape.org/documentation_developers.html">cytoscape developer page</a></li>
<li><a href="http://nrnb.org/training.html">nrnb.org/training.html</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kozo Nishida.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
